import streamlit as st

st.set_page_config(page_title="操作マニュアル", page_icon="📖", layout="wide")

st.title("📖 操作マニュアル")
st.markdown("--- ")

st.header("報告の流れ")
st.write("報告には、直接報告を完了させる方法と、一度下書きとして保存してから報告を完了させる方法の2つのパターンがあります。")

# --- パターン1: 新規報告を直接提出する ---
st.subheader("パターン1: 新規報告を直接提出する流れ")
with st.expander("詳細な手順はこちら", expanded=False):
    st.markdown("""
    **急いでいる場合や、報告内容が固まっている場合に適した方法です。**

    1.  **ログイン**
        *   サイドバーから「Login」ページに移動し、割り当てられたユーザー名とパスワードでログインします。

    2.  **新規報告ページへの移動**
        *   ログイン後、サイドバーから「新規報告」ページを選択します。

    3.  **報告フォームの入力**
        *   表示されたフォームに、インシデントの情報を正確に入力します。
        *   **報告者氏名:** ログインしているユーザー名が自動で入力されます。
        *   **影響度レベル:** 事象が患者様や職員に与えた影響の度合いを選択します。定義は「レベル定義の確認」で確認できます。
        *   **発生日時:** インシデントが発生した正確な日時を入力します。
        *   **報告者・患者情報:** 各項目を正確に入力してください。
        *   **状況と対策:** 「発生の状況と直後の対応」と「今後の対策」は、具体的かつ詳細に記載してください。
        *   **インシデントの詳細:** 最も関連性の高い「大分類」を選択し、該当する「詳細」項目にチェックを入れます。

    4.  **報告の提出**
        *   すべての必須項目を入力し終えたら、フォーム下部にある「✅ この内容で報告する」ボタンをクリックします。
        *   「報告がデータベースに保存されました。」というメッセージが表示されれば、報告は完了です。報告内容は「承認管理」ページに送られます。
    """)

# --- パターン2: 下書き機能を利用する ---
st.subheader("パターン2: 下書き機能を利用して報告する流れ")
with st.expander("詳細な手順はこちら", expanded=False):
    st.markdown("""
    **報告内容を後で確認・修正したい場合や、入力に時間がかかる場合に便利な方法です。**

    1.  **下書きの保存**
        *   「新規報告」ページで、入力の途中でもフォーム下部にある「📝 下書き保存」ボタンをクリックすると、その時点での入力内容が保存されます。
        *   「下書きを保存しました。」というメッセージが表示されます。

    2.  **下書きの確認と編集再開**
        *   サイドバーから「下書き管理」ページに移動します。
        *   保存した下書きが一覧で表示されます。
        *   編集を再開したい下書きの「この下書きを読み込む」ボタンをクリックします。

    3.  **報告の再開と提出**
        *   自動的に「新規報告」ページに移動し、下書きの内容がフォームに読み込まれます。
        *   内容の修正や追記を行います。
        *   入力が完了したら、フォーム下部の「✅ この内容で報告する」ボタンをクリックして報告を完了させます。
        *   提出された下書きは、自動的に下書き管理の一覧から削除されます。
    """)

st.markdown("--- ")
st.header("その他")
st.markdown("""
-   **データ一覧:** 提出されたすべての報告を検索・閲覧できます。
-   **グラフ分析:** 報告データを様々な角度からグラフで可視化し、傾向を分析できます。
-   **承認管理:** 管理者権限を持つユーザーは、提出された報告の承認やコメントの追加ができます。
-   **LINE WORKS連携:** 報告が承認されると、LINE WORKSの全体トークに報告書のPDFが共有されます。
""")
